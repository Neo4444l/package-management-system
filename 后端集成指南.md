# ğŸ”— åŒ…è£¹ç®¡ç†ç³»ç»Ÿ - åç«¯é›†æˆæŒ‡å—

## ğŸ“Œ ä¸ºä»€ä¹ˆéœ€è¦åç«¯ï¼Ÿ

**å½“å‰é™åˆ¶ï¼ˆä»…LocalStorageï¼‰ï¼š**
- âŒ æ¯ä¸ªç”¨æˆ·æ•°æ®ç‹¬ç«‹ï¼Œæ— æ³•å…±äº«
- âŒ æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ä¼šä¸¢å¤±æ•°æ®
- âŒ æ— æ³•å¤šè®¾å¤‡åŒæ­¥
- âŒ æ— ç”¨æˆ·ç®¡ç†å’Œæƒé™æ§åˆ¶

**æ·»åŠ åç«¯çš„å¥½å¤„ï¼š**
- âœ… å¤šäººå…±äº«åŒä¸€å¥—æ•°æ®
- âœ… æ•°æ®æ°¸ä¹…ä¿å­˜åœ¨äº‘ç«¯
- âœ… æ”¯æŒå¤šè®¾å¤‡è®¿é—®
- âœ… å¯ä»¥æ·»åŠ ç”¨æˆ·ç™»å½•å’Œæƒé™ç®¡ç†
- âœ… æ•°æ®å¤‡ä»½å’Œæ¢å¤

---

## ğŸ¯ æ¨èæ–¹æ¡ˆï¼šSupabaseï¼ˆå®Œå…¨å…è´¹ï¼‰

**ä¸ºä»€ä¹ˆé€‰æ‹©Supabaseï¼Ÿ**
- âœ… å®Œå…¨å…è´¹ï¼ˆæ¯æœˆ500MBæ•°æ®åº“ + 1GBæ–‡ä»¶å­˜å‚¨ï¼‰
- âœ… æ— éœ€ç¼–å†™åç«¯ä»£ç 
- âœ… è‡ªåŠ¨ç”ŸæˆAPI
- âœ… å†…ç½®ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- âœ… å®æ—¶æ•°æ®åŒæ­¥
- âœ… 5åˆ†é’Ÿå®Œæˆé…ç½®

---

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºSupabaseé¡¹ç›®

### 1. æ³¨å†ŒSupabaseè´¦å·

1. è®¿é—®ï¼šhttps://supabase.com
2. ç‚¹å‡» **"Start your project"**
3. ä½¿ç”¨GitHubè´¦å·ç™»å½•ï¼ˆæ¨èï¼‰

### 2. åˆ›å»ºæ–°é¡¹ç›®

1. ç‚¹å‡» **"New Project"**
2. å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
   - **Name**: `package-management-system`
   - **Database Password**: è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ï¼ˆè¯·è®°ä½ï¼ï¼‰
   - **Region**: é€‰æ‹© **Southeast Asia (Singapore)** ï¼ˆç¦»ä¸­å›½æœ€è¿‘ï¼‰
3. ç‚¹å‡» **"Create new project"**
4. ç­‰å¾…2-3åˆ†é’Ÿåˆå§‹åŒ–å®Œæˆ

---

## ğŸ“Š ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ•°æ®åº“è¡¨

### 1. åˆ›å»º packages è¡¨ï¼ˆåŒ…è£¹æ•°æ®ï¼‰

åœ¨Supabaseæ§åˆ¶å°ï¼š

1. ç‚¹å‡»å·¦ä¾§ **"Table Editor"**
2. ç‚¹å‡» **"Create a new table"**
3. é…ç½®å¦‚ä¸‹ï¼š

**è¡¨å**: `packages`

**åˆ—é…ç½®**ï¼š

| åˆ—å | ç±»å‹ | é»˜è®¤å€¼ | å…¶ä»– |
|------|------|--------|------|
| id | uuid | gen_random_uuid() | Primary Key |
| package_number | text | - | ä¸å…è®¸ç©º |
| location | text | - | ä¸å…è®¸ç©º |
| package_status | text | 'in-warehouse' | ä¸å…è®¸ç©º |
| customer_service | text | null | å…è®¸ç©º |
| shelving_time | timestamptz | now() | ä¸å…è®¸ç©º |
| unshelving_time | timestamptz | null | å…è®¸ç©º |
| instruction_time | timestamptz | null | å…è®¸ç©º |
| status_history | jsonb | '[]'::jsonb | ä¸å…è®¸ç©º |
| created_at | timestamptz | now() | ä¸å…è®¸ç©º |

4. ç‚¹å‡» **"Save"**

### 2. åˆ›å»º locations è¡¨ï¼ˆåº“ä½æ•°æ®ï¼‰

å†æ¬¡ç‚¹å‡» **"Create a new table"**ï¼š

**è¡¨å**: `locations`

**åˆ—é…ç½®**ï¼š

| åˆ—å | ç±»å‹ | é»˜è®¤å€¼ | å…¶ä»– |
|------|------|--------|------|
| id | uuid | gen_random_uuid() | Primary Key |
| code | text | - | ä¸å…è®¸ç©ºï¼Œå”¯ä¸€ |
| created_at | timestamptz | now() | ä¸å…è®¸ç©º |

å‹¾é€‰ **"Enable Row Level Security (RLS)"**

4. ç‚¹å‡» **"Save"**

### 3. è®¾ç½®è®¿é—®æƒé™ï¼ˆé‡è¦ï¼ï¼‰

ä¸ºäº†è®©ä»»ä½•äººéƒ½èƒ½è®¿é—®ï¼ˆæš‚æ—¶ä¸éœ€è¦ç™»å½•ï¼‰ï¼š

1. ç‚¹å‡» **"Authentication"** â†’ **"Policies"**
2. å¯¹äº `packages` è¡¨ï¼Œç‚¹å‡» **"New Policy"**
3. é€‰æ‹© **"Create a policy from scratch"**
4. é…ç½®ï¼š
   - **Policy name**: `å…è®¸æ‰€æœ‰äººè®¿é—®`
   - **Allowed operations**: å‹¾é€‰æ‰€æœ‰ï¼ˆSELECT, INSERT, UPDATE, DELETEï¼‰
   - **Target roles**: `anon`, `authenticated`
   - **USING expression**: `true`
   - **WITH CHECK expression**: `true`
5. ç‚¹å‡» **"Save policy"**

å¯¹ `locations` è¡¨é‡å¤ç›¸åŒæ­¥éª¤ã€‚

---

## ğŸ’» ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹å‰ç«¯ä»£ç 

### 1. å®‰è£…Supabaseå®¢æˆ·ç«¯

åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­è¿è¡Œï¼š

```bash
npm install @supabase/supabase-js
```

### 2. åˆ›å»ºSupabaseé…ç½®æ–‡ä»¶

åˆ›å»º `src/supabaseClient.js`ï¼š

```javascript
import { createClient } from '@supabase/supabase-js'

// ä»Supabaseæ§åˆ¶å°è·å–è¿™ä¸¤ä¸ªå€¼
const supabaseUrl = 'YOUR_SUPABASE_URL'  // æ›¿æ¢ä¸ºæ‚¨çš„URL
const supabaseAnonKey = 'YOUR_SUPABASE_ANON_KEY'  // æ›¿æ¢ä¸ºæ‚¨çš„Key

export const supabase = createClient(supabaseUrl, supabaseAnonKey)
```

**è·å–URLå’ŒKeyçš„æ–¹æ³•**ï¼š
1. åœ¨Supabaseæ§åˆ¶å°ï¼Œç‚¹å‡» **"Settings"** â†’ **"API"**
2. å¤åˆ¶ **"Project URL"** â†’ ç²˜è´´åˆ° `supabaseUrl`
3. å¤åˆ¶ **"anon public"** key â†’ ç²˜è´´åˆ° `supabaseAnonKey`

### 3. ä¿®æ”¹æ•°æ®å­˜å‚¨é€»è¾‘

æˆ‘å°†ä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªæ•°æ®æœåŠ¡å±‚æ–‡ä»¶ã€‚

---

## ğŸ“ å®Œæ•´ä»£ç ç¤ºä¾‹

### `src/services/dataService.js`ï¼ˆæ–°å»ºï¼‰

```javascript
import { supabase } from '../supabaseClient'

// ==================== åŒ…è£¹ç›¸å…³æ“ä½œ ====================

// è·å–æ‰€æœ‰åŒ…è£¹
export async function getAllPackages() {
  const { data, error } = await supabase
    .from('packages')
    .select('*')
    .order('created_at', { ascending: false })
  
  if (error) {
    console.error('è·å–åŒ…è£¹å¤±è´¥:', error)
    return []
  }
  return data
}

// æ·»åŠ åŒ…è£¹
export async function addPackage(packageData) {
  const { data, error } = await supabase
    .from('packages')
    .insert([{
      package_number: packageData.packageNumber,
      location: packageData.location,
      package_status: packageData.packageStatus || 'in-warehouse',
      customer_service: packageData.customerService || null,
      shelving_time: new Date().toISOString(),
      status_history: packageData.statusHistory || []
    }])
    .select()
  
  if (error) {
    console.error('æ·»åŠ åŒ…è£¹å¤±è´¥:', error)
    throw error
  }
  return data[0]
}

// æ›´æ–°åŒ…è£¹
export async function updatePackage(id, updates) {
  const { data, error } = await supabase
    .from('packages')
    .update(updates)
    .eq('id', id)
    .select()
  
  if (error) {
    console.error('æ›´æ–°åŒ…è£¹å¤±è´¥:', error)
    throw error
  }
  return data[0]
}

// åˆ é™¤åŒ…è£¹
export async function deletePackage(id) {
  const { error } = await supabase
    .from('packages')
    .delete()
    .eq('id', id)
  
  if (error) {
    console.error('åˆ é™¤åŒ…è£¹å¤±è´¥:', error)
    throw error
  }
}

// ==================== åº“ä½ç›¸å…³æ“ä½œ ====================

// è·å–æ‰€æœ‰åº“ä½
export async function getAllLocations() {
  const { data, error } = await supabase
    .from('locations')
    .select('*')
    .order('created_at', { ascending: true })
  
  if (error) {
    console.error('è·å–åº“ä½å¤±è´¥:', error)
    return []
  }
  return data
}

// æ·»åŠ åº“ä½
export async function addLocation(code) {
  const { data, error } = await supabase
    .from('locations')
    .insert([{ code }])
    .select()
  
  if (error) {
    console.error('æ·»åŠ åº“ä½å¤±è´¥:', error)
    throw error
  }
  return data[0]
}

// åˆ é™¤åº“ä½
export async function deleteLocation(id) {
  const { error } = await supabase
    .from('locations')
    .delete()
    .eq('id', id)
  
  if (error) {
    console.error('åˆ é™¤åº“ä½å¤±è´¥:', error)
    throw error
  }
}
```

---

## ğŸ”„ ç¬¬å››æ­¥ï¼šæ›´æ–°ç»„ä»¶ä½¿ç”¨æ–°API

### ç¤ºä¾‹ï¼šä¿®æ”¹ `ShelvingInput.jsx`

åœ¨æ–‡ä»¶é¡¶éƒ¨å¯¼å…¥ï¼š
```javascript
import { addPackage } from '../services/dataService'
```

ä¿®æ”¹æ·»åŠ åŒ…è£¹çš„å‡½æ•°ï¼š
```javascript
const handleAddPackage = async () => {
  if (!packageNumber.trim()) {
    alert('è¯·è¾“å…¥åŒ…è£¹å·')
    return
  }

  try {
    const newPackage = await addPackage({
      packageNumber: packageNumber.trim(),
      location: selectedLocation,
      packageStatus: 'in-warehouse',
      statusHistory: []
    })
    
    // æ›´æ–°æœ¬åœ°çŠ¶æ€
    setPackages([...packages, newPackage])
    setPackageNumber('')
    alert('æ·»åŠ æˆåŠŸï¼')
  } catch (error) {
    alert('æ·»åŠ å¤±è´¥ï¼š' + error.message)
  }
}
```

---

## ğŸ” å¯é€‰ï¼šæ·»åŠ ç”¨æˆ·è®¤è¯

å¦‚æœæ‚¨æƒ³è¦ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼š

### 1. å¯ç”¨é‚®ç®±è®¤è¯

åœ¨Supabaseæ§åˆ¶å°ï¼š
1. **"Authentication"** â†’ **"Providers"**
2. å¯ç”¨ **"Email"**

### 2. åˆ›å»ºç™»å½•ç»„ä»¶

```javascript
import { supabase } from '../supabaseClient'

// æ³¨å†Œ
async function signUp(email, password) {
  const { data, error } = await supabase.auth.signUp({
    email,
    password
  })
  return { data, error }
}

// ç™»å½•
async function signIn(email, password) {
  const { data, error } = await supabase.auth.signInWithPassword({
    email,
    password
  })
  return { data, error }
}

// ç™»å‡º
async function signOut() {
  const { error } = await supabase.auth.signOut()
  return { error }
}

// è·å–å½“å‰ç”¨æˆ·
function getCurrentUser() {
  return supabase.auth.getUser()
}
```

---

## ğŸ“ æ•°æ®è¿ç§»ï¼ˆå°†LocalStorageæ•°æ®è¿ç§»åˆ°Supabaseï¼‰

åˆ›å»ºä¸€ä¸ªè¿ç§»å·¥å…·ï¼š

```javascript
// src/utils/migrateData.js
import { supabase } from '../supabaseClient'

export async function migrateLocalStorageToSupabase() {
  // è·å–LocalStorageæ•°æ®
  const packagesStr = localStorage.getItem('packages')
  const locationsStr = localStorage.getItem('locations')
  
  if (packagesStr) {
    const packages = JSON.parse(packagesStr)
    for (const pkg of packages) {
      await supabase.from('packages').insert([{
        package_number: pkg.packageNumber,
        location: pkg.location,
        package_status: pkg.packageStatus,
        customer_service: pkg.customerService,
        shelving_time: pkg.shelvingTime,
        unshelving_time: pkg.unshelvingTime,
        instruction_time: pkg.instructionTime,
        status_history: pkg.statusHistory
      }])
    }
  }
  
  if (locationsStr) {
    const locations = JSON.parse(locationsStr)
    for (const loc of locations) {
      await supabase.from('locations').insert([{
        code: loc.code,
        created_at: loc.createdAt
      }])
    }
  }
  
  console.log('æ•°æ®è¿ç§»å®Œæˆï¼')
}
```

åœ¨é¦–é¡µæ·»åŠ ä¸€ä¸ª"è¿ç§»æ•°æ®"æŒ‰é’®ï¼Œç‚¹å‡»åæ‰§è¡Œæ­¤å‡½æ•°ã€‚

---

## âœ… éƒ¨ç½²æ›´æ–°åçš„ä»£ç 

ä¿®æ”¹å®Œæˆåï¼š

```bash
# æäº¤æ›´æ”¹
git add .
git commit -m "æ·»åŠ Supabaseåç«¯æ”¯æŒ"
git push
```

Vercelä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²ï¼

---

## ğŸ¯ æµ‹è¯•æ¸…å•

éƒ¨ç½²åè¯·æµ‹è¯•ï¼š
- âœ… æ·»åŠ åº“ä½
- âœ… æ·»åŠ åŒ…è£¹
- âœ… æ›´æ–°åŒ…è£¹çŠ¶æ€
- âœ… åˆ é™¤è®°å½•
- âœ… åœ¨ä¸åŒæµè§ˆå™¨/è®¾å¤‡ä¸ŠæŸ¥çœ‹æ•°æ®æ˜¯å¦åŒæ­¥

---

## ğŸ’¡ è¿›é˜¶åŠŸèƒ½

### 1. å®æ—¶æ•°æ®åŒæ­¥

```javascript
// ç›‘å¬æ•°æ®å˜åŒ–
supabase
  .channel('packages-changes')
  .on('postgres_changes', 
    { event: '*', schema: 'public', table: 'packages' },
    (payload) => {
      console.log('æ•°æ®æ›´æ–°:', payload)
      // åˆ·æ–°æ•°æ®
    }
  )
  .subscribe()
```

### 2. æ•°æ®å¤‡ä»½

åœ¨Supabaseæ§åˆ¶å°å¯ä»¥ï¼š
- å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“
- è®¾ç½®è‡ªåŠ¨å¤‡ä»½
- æ¢å¤åˆ°ä»»æ„æ—¶é—´ç‚¹ï¼ˆä»˜è´¹åŠŸèƒ½ï¼‰

### 3. æ€§èƒ½ä¼˜åŒ–

- æ·»åŠ æ•°æ®åº“ç´¢å¼•
- ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢
- ç¼“å­˜å¸¸ç”¨æ•°æ®

---

## ğŸ†š å¯¹æ¯”ï¼šå‡çº§å‰å

| åŠŸèƒ½ | LocalStorage | Supabase |
|------|--------------|----------|
| æ•°æ®å…±äº« | âŒ | âœ… |
| æ•°æ®æŒä¹…åŒ– | âŒï¼ˆå¯èƒ½ä¸¢å¤±ï¼‰ | âœ… |
| å¤šè®¾å¤‡åŒæ­¥ | âŒ | âœ… |
| ç”¨æˆ·ç®¡ç† | âŒ | âœ… |
| æ•°æ®å¤‡ä»½ | âŒ | âœ… |
| å®æ—¶åŒæ­¥ | âŒ | âœ… |
| æˆæœ¬ | å…è´¹ | å…è´¹ |

---

## ğŸ”— æœ‰ç”¨çš„èµ„æº

- **Supabaseæ–‡æ¡£**: https://supabase.com/docs
- **Supabase JSå®¢æˆ·ç«¯**: https://supabase.com/docs/reference/javascript
- **React + Supabaseæ•™ç¨‹**: https://supabase.com/docs/guides/getting-started/quickstarts/reactjs

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨æ‚¨çš„åŒ…è£¹ç®¡ç†ç³»ç»Ÿå·²ç»ï¼š
- âœ… éƒ¨ç½²åˆ°Vercelï¼ˆå…¨çƒå¯è®¿é—®ï¼‰
- âœ… ä½¿ç”¨Supabaseåç«¯ï¼ˆæ•°æ®äº‘ç«¯å­˜å‚¨ï¼‰
- âœ… æ”¯æŒå¤šäººåä½œ
- âœ… å®Œå…¨å…è´¹

**äº«å—æ‚¨çš„äº‘ç«¯åŒ…è£¹ç®¡ç†ç³»ç»Ÿå§ï¼** ğŸš€

